<!DOCTYPE html>
<html>
<head>
  <title>Donate to Glide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' type='text/css' href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css'/>
<style type="text/css">
    #intro { margin-bottom: 20px; }
    .orange { color: #f77408; }
    .logo { text-align: center; margin: 20px 0; }
    .logo img { position: relative; left: -2px; }
    h4 { margin-top: 30px; }
    .amounts { margin-bottom: 15px; }
    .amounts li {
        padding: 0 0 0 15px;
        line-height: 42px;
        height: 42px;
    }
    .amounts li label { margin-bottom: 0; }
    .amounts li > input { height: 40px; margin: 0; float: left;}
    .amounts li > div { margin-left: 28px; border-left: 1px solid #ddd; padding-left: 20px; }
    .amounts li.custom > div { padding-left: 0; overflow: hidden; }
    .amounts li.custom input[type="text"] {
        border: 0; line-height: 40px; padding: 0 0 0 20px; height: 40px;
        box-shadow: none; -webkit-box-shadow: none;
    }
    .continue { text-align: right; }
    .modal-body .message { margin: 0; }
    #pick-method { text-align: center; }
    #pick-method .panel-body { padding-bottom: 0; }
    .method { margin-bottom: 20px; }
    .method p { margin-bottom: 5px; }
</style>

</head>
<body>

<div class="container-fluid">
<div class="row" id="intro">

    <div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
        <!--<div class="logo"><img src="glide-50-logo.jpg" width="163" height="225"/></div>-->

        <span class="orange">
          A radically inclusive, just and loving community mobilized to alleviate suffering and break the cycles of poverty and marginalization.
        </span>
    </div>

</div>

<div class="row">
    <div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">

        <div class="panel-group" id="accordion">

            <div class="panel panel-default">
                <div class="panel-heading">
                    <a data-toggle="collapse" data-parent="#accordion" href="#pick-amount">
                        <h4 class="panel-title">
                            How much would you like to donate?
                        </h4>
                    </a>
                </div>

                <div id="pick-amount" class="panel-collapse collapse in">
                    <div class="panel-body">

                        <ul class="list-group amounts">
                            <li class="list-group-item">
                                <input type="radio" name="amount" value="2500">
                                <div>$2,500</div>
                            </li>

                            <li class="list-group-item">
                                <input type="radio" name="amount" value="1000">
                                <div>$1,000</div>
                            </li>

                            <li class="list-group-item">
                                <input type="radio" name="amount" value="500" checked>
                                <div>$500</div>
                            </li>

                            <li class="list-group-item custom">
                                <input type="radio" name="amount" value="custom">
                                <div>
                                    <input type="text" name="custom_amount" class="form-control" placeholder="Enter an amount" type="number" pattern="\d+">
                                </div>
                            </li>
                        </ul>

                        <div class="continue">
                            <button class="btn btn-primary">Continue</button>
                        </div>

                    </div>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <a data-toggle="collapse" data-parent="#accordion" href="#pick-method">
                        <h4 class="panel-title">
                            How would you like to pay?
                        </h4>
                    </a>
                </div>

                <div id="pick-method" class="panel-collapse collapse">
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-sm-6 method">
                                <p>With a credit card:</p>
                                <button class="btn btn-primary" id="pay-with-card">Pay with card</button>
                            </div>

                            <div class="col-sm-6 method">
                                <p>With Paypal:</p>
                                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" id="paypal">
                                    <input type="hidden" name="amount" id="paypal-amount">
                                    <input type="hidden" name="cmd" value="_donations">
                                    <input type="hidden" name="business">
                                    <input type="hidden" name="lc" value="US">
                                    <input type="hidden" name="item_name" value="Donation">
                                    <input type="hidden" name="no_note" value="0">
                                    <input type="hidden" name="currency_code" value="USD">
                                    <input type="hidden" name="bn" value="PP-DonationsBF:btn_donateCC_LG.gif:NonHostedGuest">
                                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                                    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                                </form>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-6 method">
                                <p>With Amazon Simple Pay:</p>
                                <form action="https://authorize.payments.amazon.com/pba/paypipeline" method="post">
                                    <input type="hidden" name="processImmediate" value="1" >
                                    <input type="hidden" name="signatureMethod" value="HmacSHA256" >
                                    <input type="hidden" name="accessKey" value="11SEM03K88SD016FS1G2" >
                                    <input type="hidden" name="collectShippingAddress" value="0" >
                                    <input type="hidden" name="isDonationWidget" value="1" >
                                    <input type="hidden" name="description" value="Support Glide Foundation" >
                                    <input type="hidden" name="amazonPaymentsAccountId" value="XHWRVRUHBPYO2283NDJS5FXTMSN5AN7GURBRMC" >
                                    <input type="hidden" name="cobrandingStyle" value="logo" >
                                    <input type="hidden" name="signatureVersion" value="2" >
                                    <input type="hidden" name="immediateReturn" value="1" >
                                    <input type="hidden" name="signature" value="Geirs4n2cziqRMhpfoKCb1vDDZs054IONh45JbSjECs=" >
                                    <input type="hidden" name="amount" id="amazon-amount">
                                    <input type="image" src="http://g-ecx.images-amazon.com/images/G/01/asp/beige_small_donate_withmsg_whitebg.gif" border="0">
                                </form>
                            </div>

                            <div class="col-sm-6 method">
                                <p>With Google Wallet:</p>
                                <button class="google-wallet btn btn-primary">Donate</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

<div class="modal fade" id="result">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="message">Loading...</h4>
            </div>
        </div>
    </div>
</div>

<script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js'></script>
<script type='text/javascript' src='//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js'></script>
<script src="https://checkout.stripe.com/checkout.js"></script>
<script src="https://wallet.google.com/inapp/lib/buy.js"></script>
    <script type='text/javascript' >
        var stripePublishableKey = 'pk_test_WCgvPMzqFrQtoGuDF2EKlLhv';
        var stripeServerUrl      = 'https://stormy-chamber-7425.herokuapp.com/pay';
        var organizationName     = 'Glide Foundation';
        var successText          = 'Thank you so much for your contribution!';
        var paypalEmail          = 'paypal@glide.org';

        var currentAmount;

        var include = function(file, callback) {
            var head      = document.getElementsByTagName('head')[0];
            var script    = document.createElement('script');
            script.type   = 'text/javascript';
            script.src    = file;
            script.onload = script.onreadystatechange = function() {
                // execute dependent code
                if (callback) callback();
                // prevent memory leak in IE
                head.removeChild(script);
                script.onload = null;
            };
            head.appendChild(script);
        };

        window.showResult = function(result) {
            var modal = $('#result');
            if (result.error) {
                modal.find('.message').text(result.error);
            } else {
                modal.find('.message').text(successText);
            }
        };

        var stripeHandler = StripeCheckout.configure({
            key: stripePublishableKey,
            token: function(token, args) {
                var data = {token: token.id, email: token.email, amount: currentAmount};
                var url = stripeServerUrl + "?cb=showResult&" + $.param(data);
                $('#result').find('.message').text('Please wait...').end().modal();
                include(url);
            }
        });

        var updateAmount = function() {
            var amount = $('[name="amount"]:checked').val();
            if (amount == 'custom')
                amount = $('[name="custom_amount"]').val();

            currentAmount = amount;
            $('#paypal-amount').val(currentAmount);
            $('#amazon-amount').val('USD ' + currentAmount);
        };

        var validateAmount = function(callback) {
            if (parseInt(currentAmount).toString() == currentAmount) {
                callback();
            } else {
                alert('Please enter a valid amount.');
                $('[name="custom_amount"]').val('').focus();
            }
        };

        $(function() {
            // allow clicking anywhere in the list group item to select an amount
            $('.amounts .list-group-item').click(function() {
                $('.amounts input').prop('checked', false);
                $(this).find('input').prop('checked', true);
                updateAmount();
            });

            // keep the amount up to date as the selection changes
            $('[name="amount"], [name="custom_amount"]').change(function() {
                updateAmount();
            });

            // initialize the value from the first selected radio button
            updateAmount();

            $('.continue button').click(function() {
                validateAmount(function() {
                    $('#pick-method').collapse({parent: '#accordion', toggle: true});
                })
                return false;
            })

            // set up PayPal variables
            $('#paypal [name="business"]').val(paypalEmail);

            $('#pay-with-card').click(function(e) {
                stripeHandler.open({
                    name: organizationName,
                    description: 'Donation',
                    amount: currentAmount * 100
                });
                e.preventDefault();
            });
        })

    </script>

</body>
</html>