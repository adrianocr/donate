<!DOCTYPE html>
<html>
<head>
  <title>Donate to Glide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' type='text/css' href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css'/>
  <link rel="stylesheet" type="text/css" href="style.css" />
  <style>
  .orange { color: #f77408; }
  .logo { text-align: center; margin: 10px 0; }
  .logo img { position: relative; left: -2px; }
  h4 { margin-top: 30px; }
  .amounts .list-group-item {
    padding: 0 0 0 15px;
    line-height: 42px;
    height: 42px;
  }
  .amounts li label { margin-bottom: 0; }
  .amounts li > input { height: 40px; margin: 0; float: left;}
  .amounts li > div { margin-left: 28px; border-left: 1px solid #ddd; padding-left: 20px; }
  .amounts li.custom > div { padding-left: 0; overflow: hidden; }
  .amounts li.custom input[type="text"] {
    border: 0; line-height: 40px; padding: 0 0 0 20px; height: 40px;
    box-shadow: none; -webkit-box-shadow: none;
  }
  .modal-body .message { margin: 0; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">

      <div class="col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4">
        <div class="logo"><img src="glide-50-logo.jpg" width="163" height="225"/></div>

        <p class="orange">
          A radically inclusive, just and loving community mobilized to alleviate suffering and break the cycles of poverty and marginalization.
        </p>

        <h4>How much would you like to donate?</h4>

        <ul class="list-group amounts">
          <li class="list-group-item">
            <input type="radio" name="amount" value="2500">
            <div>$2,500</div>
          </li>

          <li class="list-group-item">
            <input type="radio" name="amount" value="1000">
            <div>$1,000</div>
          </li>

          <li class="list-group-item">
            <input type="radio" name="amount" value="500" checked>
            <div>$500</div>
          </li>

          <li class="list-group-item custom">
            <input type="radio" name="amount" value="custom">
            <div>
              <input type="text" name="custom_amount" class="form-control" placeholder="Enter an amount" type="number" pattern="\d+">
            </div>
          </li>
        </ul>

        <h4>How would you like to pay?</h4>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-3 col-sm-offset-3 col-md-2 col-md-offset-4">
        <p>With a credit card:</p>
        <button class="btn btn-primary" id="pay-with-card">Pay with card</button>
      </div>

      <div class="col-sm-3 col-md-2">
        <p>With Paypal:</p>
        <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="amount" id="paypal-amount">
        <input type="hidden" name="cmd" value="_donations">
        <input type="hidden" name="business" value="paypal@glide.org">
        <input type="hidden" name="lc" value="US">
        <input type="hidden" name="item_name" value="Glide Foundation">
        <input type="hidden" name="no_note" value="0">
        <input type="hidden" name="currency_code" value="USD">
        <input type="hidden" name="bn" value="PP-DonationsBF:btn_donateCC_LG.gif:NonHostedGuest">
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
        </form>
      </div>
    </div>

  </div>

  <div class="modal fade" id="result">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-body">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="message">Loading...</h4>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js'></script>
  <script type='text/javascript' src='//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js'></script>
  <script src="https://checkout.stripe.com/checkout.js"></script>

  <script type='text/javascript'>

    var stripeServerUrl = 'https://stormy-chamber-7425.herokuapp.com/pay',
      currentAmount;

    function include(file, callback) {
      var head      = document.getElementsByTagName('head')[0];
      var script    = document.createElement('script');
      script.type   = 'text/javascript';
      script.src    = file;
      script.onload = script.onreadystatechange = function() {
        // execute dependent code
        if (callback) callback();
        // prevent memory leak in IE
        head.removeChild(script);
        script.onload = null;
      };
      head.appendChild(script);
    };

    window.stripeComplete = function(result) {
      var modal = $('#result');
      if (result.error) {
        modal.find('.message').text(result.error);
      } else {
        modal.find('.message').text("Thank you so much for your contribution!");
      }
    };

    var stripeHandler = StripeCheckout.configure({
      key: 'pk_test_WCgvPMzqFrQtoGuDF2EKlLhv',
      token: function(token, args) {
        // Use the token to create the charge with a server-side script.
        // You can access the token ID with `token.id`
        var data = {token: token.id, email: token.email, amount: currentAmount};
        var url = stripeServerUrl + "?cb=stripeComplete&" + $.param(data);
        $('#result').find('.message').text('Please wait...').end().modal();
        include(url);
      }
    });

    var updateAmount = function() {
      var amount = $('[name="amount"]:checked').val();
      if (amount == 'custom')
        amount = $('[name="custom_amount"]').val();

      currentAmount = amount;
      $('#paypal-amount').val(currentAmount);
      if (window.console) console.log('amount: ' + currentAmount);
    }

    $(function() {
      // allow clicking anywhere in the list group item to select an amount
      $('.amounts .list-group-item').click(function() {
        $('.amounts input').prop('checked', false);
        $(this).find('input').prop('checked', true);
        updateAmount();
      });

      // keep the amount up to date as the selection changes
      $('[name="amount"], [name="custom_amount"]').change(function() {
        updateAmount();
      });

      // initialize the value from the first selected radio button
      updateAmount();

      $('#pay-with-card').click(function(e) {
        stripeHandler.open({
          name: 'Glide Foundation',
          description: 'Donation',
          amount: currentAmount * 100
        });
        e.preventDefault();
      });

    })
  </script>
</body>
</html>